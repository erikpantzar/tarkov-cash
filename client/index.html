<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>how much left</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.4.4/d3.min.js"></script>
</head>
<body>
  <h1 style="position: absolute; left: 20px; bottom: 20px;">Cash left?</h1>

  <!-- Create a div where the graph will take place -->
<div id="cash" style="position: absolute; top: 0; left: 0"></div>


<script>
  async function init() {
  const ind = await fetch('/api').then(res => res.json())
  const data = ind[0].value.map(e => {
    return {
      date: new Date(e.date),
      value: Number(e.value)
    }
  })

  const getSorted = () => {
    let sorted = data.sort((a, b) => {
      return a.value - b.value
    })

    return {low: sorted[0], high: sorted[data.length -1]}
  }
  const { high, low } = getSorted()

  const scaleTime = d3.scaleTime()
    .domain([new Date(low.date), new Date(high.date)])
    .range([0, 700])

  const scaleY = d3.scaleLinear()
    .domain([high.value, low.value])
    .range([20, 500])


  const svg = d3.select('#cash').append('svg').attr('width', window.innerWidth).attr('height', window.innerHeight)
  var lineFunc = d3.line()
    .x(function(d) { return scaleTime(d.date) })
    .y(function(d) { return scaleY(d.value) })
    

    // stroke
  svg.append('path')
    .attr('d', lineFunc(data))
    .attr('stroke', 'purple')
    .attr('fill', 'none')

    const xAx = d3.axisBottom()
      .scale(scaleTime)

  svg.append('g')
    .attr("transform", "translate(0, 500)")
    .call(xAx)


  const yXi = d3.axisLeft()
    .scale(scaleY)

  svg.append('g')
    .attr('transform', "translate(120, 0)")
    .call(yXi)

  


}
init()
  
</script>
</body>
</html>